---
// customOrderPage.astro
import CustomOrder from "./customOrderItem.astro"
import orders from "./product-data/orders.ts";
---

<html>
  <head>
    <title>Sweet T Bakery - Orders</title>
  </head>
  <body>
    <div class="min-h-screen font-sans font-[Inter]">
      <div class="min-h-screen bg-[#f9fafb]">
        <div class="px-4 py-6 md:px-6 max-w-6xl mx-auto">
          <div class="mb-4">
            <h2 class="mb-1">Orders</h2>
            <p class="text-gray-600" id="orders-count">{orders.length} active orders</p>
          </div>

          <!-- Search Bar -->
          <div class="mb-4">
            <div role="search" class="relative flex items-center w-full bg-white rounded-lg transition-all border border-gray-200">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-search absolute left-3 h-5 w-5 text-gray-500 pointer-events-none" aria-hidden="true">
                <path d="m21 21-4.34-4.34"></path>
                <circle cx="11" cy="11" r="8"></circle>
              </svg>
              <input 
                type="text" 
                id="search-input"
                placeholder="Search orders by customer name, product, or order number..." 
                aria-label="Search orders by customer name, product, or order number" 
                class="w-full h-12 pl-10 pr-10 text-base bg-transparent border-none outline-none placeholder:text-gray-400" 
              />
              <!-- Clear search button -->
              <button 
                id="clear-search"
                class="absolute right-3 p-1 rounded-full hover:bg-gray-100 transition-colors hidden"
                aria-label="Clear search"
              >
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x h-4 w-4 text-gray-500">
                  <path d="M18 6 6 18"></path>
                  <path d="m6 6 12 12"></path>
                </svg>
              </button>
            </div>
          </div>

          <!-- Filter Buttons -->
          <div class="flex gap-2 mb-6 overflow-x-auto pb-2">
            <button class="filter-btn px-4 py-2 rounded-full whitespace-nowrap transition-colors text-sm bg-[#044A25] text-white" data-filter="all">All</button>
            <button class="filter-btn px-4 py-2 rounded-full whitespace-nowrap transition-colors text-sm bg-white text-gray-700 border border-gray-300 hover:border-[#044A25]" data-filter="Pending">Pending</button>
            <button class="filter-btn px-4 py-2 rounded-full whitespace-nowrap transition-colors text-sm bg-white text-gray-700 border border-gray-300 hover:border-[#044A25]" data-filter="Ready for Pickup">Ready for Pickup</button>
            <button class="filter-btn px-4 py-2 rounded-full whitespace-nowrap transition-colors text-sm bg-white text-gray-700 border border-gray-300 hover:border-[#044A25]" data-filter="Complete">Complete</button>
          </div>

          <div class="space-y-3" id="orders-container">
            {orders.map((order) => ( 
              <CustomOrder 
                name={order.name} 
                order={order.order} 
                date={order.date} 
                due={order.due} 
                status={order.status}
              />
            ))}
          </div>
        </div>
      </div>
    </div>

    <script>
      document.addEventListener('DOMContentLoaded', function() {
        const searchInput = document.getElementById('search-input');
        const clearButton = document.getElementById('clear-search');
        const ordersCount = document.getElementById('orders-count');
        const filterButtons = document.querySelectorAll('.filter-btn');
        

        const totalOrders = document.querySelectorAll('[data-slot="card"]').length;
        let currentFilter = 'all';
        let currentSearchQuery = '';
        

        function getAllOrders() {
          const orderElements = document.querySelectorAll('[data-slot="card"]');
          const orders = [];
          
          orderElements.forEach(element => {
            const name = element.querySelector('h3').textContent;
            const orderText = element.querySelector('.text-gray-600').textContent;
            const dateElements = element.querySelectorAll('.text-sm');

            const date = Array.from(dateElements).find(el => 
              !el.classList.contains('bg-rose-100') && 
              !el.classList.contains('inline-flex')
            )?.textContent || '';
            const statusElement = element.querySelector('[data-slot="badge"]');
            const status = statusElement ? statusElement.textContent : '';
            
            orders.push({
              element,
              name,
              order: orderText,
              date,
              status
            });
          });
          
          return orders;
        }
        

        function updateFilterButtons(activeFilter) {
          filterButtons.forEach(button => {
            const filter = button.getAttribute('data-filter');
            if (filter === activeFilter) {

              button.classList.remove('bg-white', 'text-gray-700', 'border-gray-300');
              button.classList.add('bg-[#044A25]', 'text-white', 'border-[#044A25]');
            } else {
 
              button.classList.remove('bg-[#044A25]', 'text-white', 'border-[#044A25]');
              button.classList.add('bg-white', 'text-gray-700', 'border-gray-300');
            }
          });
        }
        

        function applyFilters() {
          const allOrders = getAllOrders();
          let filteredOrders = allOrders;
          

          if (currentFilter !== 'all') {
            filteredOrders = filteredOrders.filter(order => 
              order.status === currentFilter
            );
          }
          

          if (currentSearchQuery) {
            filteredOrders = filteredOrders.filter(order => 
              order.name.toLowerCase().includes(currentSearchQuery) ||
              order.order.toLowerCase().includes(currentSearchQuery) ||
              order.date.toLowerCase().includes(currentSearchQuery) ||
              order.status.toLowerCase().includes(currentSearchQuery)
            );
          }
          

          let countText = `${filteredOrders.length} active orders`;
          if (currentSearchQuery && currentFilter !== 'all') {
            countText = `${filteredOrders.length} of ${totalOrders} orders matching "${currentSearchQuery}" and ${currentFilter}`;
          } else if (currentSearchQuery) {
            countText = `${filteredOrders.length} of ${totalOrders} orders matching "${currentSearchQuery}"`;
          } else if (currentFilter !== 'all') {
            countText = `${filteredOrders.length} ${currentFilter} orders`;
          }
          ordersCount.textContent = countText;
          

          allOrders.forEach(order => {
            const isVisible = filteredOrders.some(filteredOrder => 
              filteredOrder.name === order.name
            );
            order.element.style.display = isVisible ? 'block' : 'none';
          });
        }
        

        filterButtons.forEach(button => {
          button.addEventListener('click', function() {
            currentFilter = this.getAttribute('data-filter');
            updateFilterButtons(currentFilter);
            applyFilters();
          });
        });
        

        searchInput.addEventListener('input', function(e) {
          currentSearchQuery = e.target.value.toLowerCase();
          

          if (currentSearchQuery) {
            clearButton.classList.remove('hidden');
          } else {
            clearButton.classList.add('hidden');
          }
          
          applyFilters();
        });
        

        clearButton.addEventListener('click', function() {
          searchInput.value = '';
          currentSearchQuery = '';
          clearButton.classList.add('hidden');
          applyFilters();
          searchInput.focus();
        });
        

        updateFilterButtons('all');
      });
    </script>
  </body>
</html>