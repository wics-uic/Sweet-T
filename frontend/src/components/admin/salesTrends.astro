---
import { analytics } from "./admin-data/sales_calculations.ts";

function formatCurrency(amount: number) {
  return amount.toLocaleString("en-US", {
    minimumFractionDigits: 0,
    maximumFractionDigits: 0,
  });
}

// Percent change helpers
function computeDelta(current: number, previous: number) {
  if (previous <= 0) return null;
  return ((current - previous) / previous) * 100;
}

const weekDelta = computeDelta(analytics.salesThisWeek, analytics.salesLastWeek);
const monthDelta = computeDelta(analytics.salesThisMonth, analytics.salesLastMonth);

const weekDeltaLabel =
  weekDelta === null
    ? "No data from last week"
    : `${weekDelta >= 0 ? "↑" : "↓"} ${Math.abs(weekDelta).toFixed(0)}% from last week`;

const monthDeltaLabel =
  monthDelta === null
    ? "No data from last month"
    : `${monthDelta >= 0 ? "↑" : "↓"} ${Math.abs(monthDelta).toFixed(0)}% from last month`;
---

<!-- Main content -->
<section class="mx-auto max-w-6xl px-6 py-8">
  <h1 class="text-2xl font-semibold text-slate-900">Sales</h1>
  <p class="mt-1 text-sm text-slate-500">
    Overview of your business performance
  </p>

  <!-- Card grid -->
  <div class="mt-6 grid gap-6 md:grid-cols-2">
    <!-- This week sales -->
    <div
      class="flex flex-col justify-between rounded-2xl border border-slate-200 bg-white p-8 shadow-sm"
    >
      <div class="flex items-start justify-between">
        <div>
          <p class="text-xs font-semibold uppercase tracking-wide text-slate-500">
            This Week
          </p>
          <p class="mt-4 text-5xl font-semibold text-emerald-900">
            ${formatCurrency(analytics.salesThisWeek)}
          </p>
        </div>
        <span class="text-2xl text-slate-300">$</span>
      </div>
      <p class="mt-6 text-sm font-medium text-emerald-600">
        {weekDeltaLabel}
      </p>
    </div>

    <!-- This month sales -->
    <div
      class="flex flex-col justify-between rounded-2xl border border-slate-200 bg-white p-8 shadow-sm"
    >
      <div class="flex items-start justify-between">
        <div>
          <p class="text-xs font-semibold uppercase tracking-wide text-slate-500">
            This Month
          </p>
          <p class="mt-4 text-5xl font-semibold text-emerald-900">
            ${formatCurrency(analytics.salesThisMonth)}
          </p>
        </div>
        <span class="text-2xl text-slate-300">$</span>
      </div>
      <p class="mt-6 text-sm font-medium text-emerald-600">
        {monthDeltaLabel}
      </p>
    </div>

    <!-- Orders this week -->
    <div
      class="flex flex-col justify-between rounded-2xl border border-slate-200 bg-white p-8 shadow-sm"
    >
      <div class="flex items-start justify-between">
        <div>
          <p class="text-xs font-semibold uppercase tracking-wide text-slate-500">
            Orders This Week
          </p>
          <p class="mt-4 text-5xl font-semibold text-emerald-900">
            {analytics.ordersThisWeek}
          </p>
        </div>
        <svg
          class="h-6 w-6 text-slate-300"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="1.8"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <rect x="3.5" y="10" width="17" height="9" rx="2" />
          <path d="M9 10L11 5" />
          <path d="M15 10L13 5" />
        </svg>
      </div>
    </div>

    <!-- Orders this month -->
    <div
      class="flex flex-col justify-between rounded-2xl border border-slate-200 bg-white p-8 shadow-sm"
    >
      <div class="flex items-start justify-between">
        <div>
          <p class="text-xs font-semibold uppercase tracking-wide text-slate-500">
            Orders This Month
          </p>
          <p class="mt-4 text-5xl font-semibold text-emerald-900">
            {analytics.ordersThisMonth}
          </p>
        </div>
        <svg
          class="h-6 w-6 text-slate-300"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="1.8"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <path d="M7 9h10l-1 9H8L7 9z" />
          <path d="M7 9h10" />
          <path d="M10 9V7a2 2 0 0 1 4 0v2" />
        </svg>
      </div>
    </div>
  </div>
</section>